<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Alpha V88 [Background ID]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { bg: '#0b0e11', panel: '#161a1e', border: '#2b3139', text: '#eaecef', subtext: '#848e9c', up: '#0ecb81', down: '#f6465d', highlight: '#f0b90b', accent: '#3b82f6' },
                    fontFamily: { mono: ['"JetBrains Mono"', 'monospace'], sans: ['Inter', 'sans-serif'] },
                    fontSize: { 'xxs': '0.65rem' }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&family=Inter:wght@400;600&display=swap');
        body { background-color: #0b0e11; color: #eaecef; font-family: 'Inter', sans-serif; overflow: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        th { position: sticky; top: 0; background: #161a1e; z-index: 10; padding: 8px; font-size: 11px; text-align: right; color: #848e9c; cursor: pointer; border-bottom: 1px solid #2b3139; transition: color 0.2s; }
        th:hover { color: #f0b90b; background: #20252b; }
        th.active-sort { color: #f0b90b; font-weight: bold; border-bottom: 2px solid #f0b90b; }
        td { padding: 6px 8px; border-bottom: 1px solid #1e2329; font-size: 12px; white-space: nowrap; }
        tr:hover { background-color: #2b3139; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #474d57; border-radius: 2px; }
        .input-dark { background: #0b0e11; border: 1px solid #2b3139; color: #eaecef; padding: 4px 8px; font-size: 12px; border-radius: 3px; width: 100%; transition: border 0.2s; text-align: center; font-weight: bold; }
        .input-dark:focus { border-color: #f0b90b; outline: none; background: #1e2329; }
        .toggle-checkbox:checked { right: 0; border-color: #f0b90b; }
        .coin-link:hover { color: #f0b90b; text-decoration: underline; }
        .dimmed { opacity: 0.3; filter: grayscale(100%); transition: opacity 0.5s; }
        /* ÁΩÆÈ°∂Ê†∑Âºè‰ºòÂåñ */
        .pinned-row { background-color: rgba(59, 130, 246, 0.08) !important; border-left: 4px solid #3b82f6 !important; }
        .pinned-icon { color: #3b82f6; cursor: pointer; transition: transform 0.2s; }
        .pinned-icon:hover { transform: scale(1.2); color: #60a5fa; }
        .unpinned-icon { color: #4b5563; cursor: pointer; transition: color 0.2s; }
        .unpinned-icon:hover { color: #9ca3af; }
        
        .highlight-lock { background-color: rgba(240, 185, 11, 0.15) !important; border-left: 4px solid #f0b90b !important; opacity: 1 !important; filter: none !important; }
        .param-group { display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 4px; border: 1px solid #2b3139; white-space: nowrap; }
        .param-label { font-size: 0.7rem; color: #848e9c; text-transform: uppercase; font-weight: 600; }
        /* ËøõÂ∫¶Êù°Ê†∑ÂºèË∞ÉÊï¥ */
        .heat-bg { background: #2b3139; height: 4px; width: 50px; display: inline-block; border-radius: 2px; overflow: hidden; vertical-align: middle; }
        .heat-fill { height: 100%; transition: width 0.5s linear; }
    </style>
</head>
<body class="h-screen flex flex-col select-none">

    <header class="h-16 bg-panel border-b border-border flex items-center px-4 justify-between shrink-0 z-20 shadow-lg">
        <div class="flex items-center gap-6 overflow-x-auto no-scrollbar w-full mr-4">
            <div class="flex items-center gap-2 mr-2 shrink-0">
                <i class="fas fa-fire text-accent text-lg"></i>
                <h1 class="font-bold text-base tracking-wider font-mono hidden lg:block">ALPHA<span class="text-accent">V88</span></h1>
            </div>
            
            <div class="flex gap-3">
                <div class="param-group" title="Âè™ÁõëÊéßÊ∂®Ë∑åÂπÖÊúÄÂ§ßÁöÑÂâçN‰∏™Â∏Å">
                    <span class="param-label">Top N</span>
                    <input type="number" id="cfg-limit" value="120" min="10" max="1000" class="input-dark w-16 text-highlight text-sm">
                </div>
                <div class="param-group" title="ÊØèËΩÆÊâ´ÊèèÂêéÁöÑ‰ºëÊÅØÊó∂Èó¥">
                    <span class="param-label">Èó¥Èöî(s)</span>
                    <input type="number" id="cfg-interval" value="3" min="0" max="60" class="input-dark w-12 text-white text-sm">
                </div>
                <div class="param-group" title="ÊØèÊ¨°Âπ∂ÂèëËØ∑Ê±ÇÁöÑÊï∞Èáè">
                    <span class="param-label">ÂêûÂêêÈáè</span>
                    <input type="number" id="cfg-batch" value="30" min="5" max="100" class="input-dark w-12 text-accent text-sm">
                </div>
                <div class="param-group border-l-2 border-l-blue-500/50" title="Ë≠¶Êä•Ëß¶ÂèëÂêéËá™Âä®ÁΩÆÈ°∂ÁöÑÊó∂Èó¥ÔºåÂÜçÊ¨°Ëß¶Âèë‰ºöÁ¥ØÂä†">
                    <span class="param-label text-blue-400">Ëá™Âä®È°∂ÁΩÆ(m)</span>
                    <input type="number" id="cfg-pin-dur" value="10" min="1" max="600" class="input-dark w-14 text-blue-400 text-sm font-bold">
                </div>
                <div class="param-group" title="Ë≠¶Êä•ÈáçÂ§çÊí≠ÊîæÊ¨°Êï∞">
                    <span class="param-label text-highlight">Êí≠Êä•Ê¨°Êï∞</span>
                    <input type="number" id="cfg-repeat" value="3" min="1" max="20" class="input-dark w-12 text-highlight text-sm text-center font-bold">
                </div>
                <div class="param-group" title="Â¶ÇÊûú1mÊàê‰∫§È¢ù‰∏∫0ÔºåË∑≥ËøáÊ£ÄÊµãNÊ¨°">
                    <span class="param-label text-red-400">0ÈáèË∑≥Ëøá</span>
                    <input type="number" id="cfg-skip" value="8" min="0" max="50" class="input-dark w-12 text-red-400 text-sm">
                </div>
            </div>
        </div>
        
        <div class="flex items-center gap-3 shrink-0">
            <div class="text-xxs text-subtext hidden xl:block text-right leading-tight font-mono">
                <div>LATENCY: <span id="stat-latency" class="text-up">--</span></div>
                <div>SKIPPED: <span id="stat-skipped" class="text-red-400">0</span></div>
            </div>
            <div id="status-badge" class="px-3 py-1 bg-red-900/30 border border-red-700 rounded text-xs text-red-500 font-mono uppercase font-bold">STOPPED</div>
            <button id="btn-toggle" class="bg-highlight hover:bg-yellow-400 text-black font-bold px-6 py-1.5 rounded text-sm flex items-center gap-2 transition-all active:scale-95 shadow-lg">
                <i class="fas fa-play"></i>
            </button>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden">
        <aside class="w-64 bg-panel border-r border-border flex flex-col shrink-0 z-10">
            <div class="p-4 border-b border-border space-y-5 overflow-y-auto">
                <div class="border-l-2 border-l-gray-600 pl-3">
                    <div class="text-xs text-gray-400 font-bold mb-3 uppercase tracking-wide">Ë≠¶Êä•Á≠õÈÄâ (FILTERS)</div>
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xxs text-subtext block mb-1">1m Ê∂®ÂπÖ%</label>
                                <input type="number" id="cfg-chg1" value="2" step="0.1" class="input-dark bg-opacity-20">
                            </div>
                            <div>
                                <label class="text-xxs text-subtext block mb-1">3m Ê∂®ÂπÖ%</label>
                                <input type="number" id="cfg-chg3" value="6" step="0.1" class="input-dark bg-opacity-20">
                            </div>
                        </div>
                        <div>
                            <label class="text-xxs text-accent font-bold block mb-1">15m Ê∂®ÂπÖ% (NEW)</label>
                            <input type="number" id="cfg-chg15" value="8.8" step="0.1" class="input-dark bg-opacity-20 text-accent">
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xxs text-highlight font-bold block mb-1">Min 1mÈ¢ù(K)</label>
                                <input type="number" id="cfg-vol" value="1" class="input-dark input-highlight text-right" title="Âè™ËøáÊª§1ÂàÜÈíüÂÜÖÁöÑUSDTÊàê‰∫§È¢ù">
                            </div>
                            <div>
                                <label class="text-xxs text-subtext block mb-1">Min Á¨îÊï∞</label>
                                <input type="number" id="cfg-trades" value="3" class="input-dark bg-opacity-20 text-right">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-between mt-2">
                    <span class="text-xs text-gray-400">Âè™ÁúãÊ∂® (No Dump)</span>
                    <input type="checkbox" id="cfg-only-up" class="accent-highlight" checked>
                </div>

                <div>
                    <label class="text-xxs text-subtext block mb-1">ÈªëÂêçÂçï (CSV)</label>
                    <input type="text" id="cfg-black" value="USDC,FDUSD,TUSD" class="input-dark text-down bg-opacity-20">
                </div>
            </div>

            <div class="flex-1 flex flex-col overflow-hidden bg-[#0d1117] border-t border-border">
                <div class="px-3 py-2 bg-[#161a1e] border-b border-border flex justify-between items-center">
                    <span class="text-xxs font-mono text-subtext font-bold">‚ö° ALERT FEED</span>
                    <button id="clear-logs" class="text-xxs text-subtext hover:text-white transition"><i class="fas fa-trash"></i></button>
                </div>
                <div id="console-logs" class="flex-1 overflow-y-auto p-2 space-y-2 font-mono text-xs text-gray-400"></div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col bg-bg relative">
            <div id="scan-progress" class="h-0.5 bg-gray-800 w-full relative hidden">
                <div id="progress-bar" class="absolute h-full bg-highlight w-0 transition-all duration-100 ease-linear"></div>
            </div>
            
            <div class="flex-1 overflow-auto">
                <table class="w-full text-right border-collapse">
                    <thead>
                        <tr>
                            <th class="text-center w-8 text-xs"><i class="fas fa-thumbtack"></i></th>
                            <th class="text-left w-32">Â∏ÅÁßç (Link)</th>
                            <th onclick="app.sort('p')">‰ª∑Ê†º</th>
                            <th onclick="app.sort('c1')">1m</th>
                            <th onclick="app.sort('c3')">3m</th>
                            <th onclick="app.sort('c15')">15m</th>
                            <th class="text-accent">ÁÉ≠Â∫¶ (Time)</th>
                            <th onclick="app.sort('v1')" id="th-v1" class="text-highlight">1m $</th>
                            <th onclick="app.sort('v5')" id="th-v5" class="text-subtext active-sort">5m $</th>
                            <th onclick="app.sort('n')">Á¨îÊï∞</th>
                        </tr>
                    </thead>
                    <tbody id="market-body"></tbody>
                </table>
                <div id="empty-state" class="hidden flex flex-col items-center justify-center h-64 text-subtext opacity-50">
                    <i class="fas fa-fire text-4xl mb-4 text-accent"></i><p class="text-xs">READY</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_BASE = 'https://www.binance.com/bapi/defi/v1/public';

        // Êú¨Âú∞Â≠òÂÇ®ÁÆ°ÁêÜÂô®
        const ConfigManager = {
            STORAGE_KEY: 'binance_alpha_cfg_v41',
            save() {
                const inputs = document.querySelectorAll('input[id^="cfg-"]');
                const settings = {};
                inputs.forEach(input => {
                    if(input.type === 'checkbox') settings[input.id] = input.checked;
                    else settings[input.id] = input.value;
                });
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(settings));
            },
            load() {
                const saved = localStorage.getItem(this.STORAGE_KEY);
                if (saved) {
                    const settings = JSON.parse(saved);
                    for (const [id, val] of Object.entries(settings)) {
                        const el = document.getElementById(id);
                        if (el) {
                            if(el.type === 'checkbox') el.checked = val;
                            else el.value = val;
                        }
                    }
                }
            },
            bind() {
                document.querySelectorAll('input[id^="cfg-"]').forEach(input => {
                    input.addEventListener('change', () => this.save());
                });
            }
        };

        class SoundSystem {
            constructor() {
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                this.enabled = false;
            }
            activate() { if (this.ctx.state === 'suspended') this.ctx.resume(); this.enabled = true; }
            
            playTone(type) {
                if (!this.enabled) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                const now = this.ctx.currentTime;

                if (type === 'pump') { 
                    osc.type = 'square'; osc.frequency.setValueAtTime(1000, now);
                    osc.frequency.linearRampToValueAtTime(1500, now + 0.15); gain.gain.setValueAtTime(0.2, now);
                    osc.start(); osc.stop(now + 0.2);
                }
                osc.connect(gain); gain.connect(this.ctx.destination);
            }

            speak(symbol, text) {
                if (!this.enabled) return;
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(symbol + "Ôºå" + text);
                u.lang = 'zh-CN'; u.rate = 1.5; u.volume = 1.0;
                window.speechSynthesis.speak(u);
            }

            trigger(type, symbol, msg, count) {
                if (!this.enabled) return;
                this.playTone(type);
                this.speak(symbol, msg);

                if (count > 1) {
                    for (let i = 1; i < count; i++) {
                        setTimeout(() => {
                            this.playTone(type);
                            this.speak(symbol, msg);
                        }, i * 3000);
                    }
                }
            }
        }

        class Terminal {
            constructor() {
                this.tokens = new Map();
                this.pairMap = new Map();
                this.pinned = new Map(); 
                this.audio = new SoundSystem();
                this.isRunning = false;
                this.timer = null;
                this.sortKey = 'v5';
                this.sortDir = -1;
                this.skippedCount = 0;
                
                this.dom = {
                    btn: document.getElementById('btn-toggle'),
                    badge: document.getElementById('status-badge'),
                    body: document.getElementById('market-body'),
                    logs: document.getElementById('console-logs'),
                    prog: document.getElementById('scan-progress'),
                    bar: document.getElementById('progress-bar'),
                    empty: document.getElementById('empty-state'),
                    lat: document.getElementById('stat-latency'),
                    skp: document.getElementById('stat-skipped')
                };

                ConfigManager.load();
                ConfigManager.bind();
            }

            toggle() {
                this.isRunning = !this.isRunning;
                if (this.isRunning) {
                    this.audio.activate();
                    this.updateUI(true);
                    this.dom.prog.classList.remove('hidden');
                    this.dom.empty.classList.add('hidden');
                    if (this.pairMap.size === 0) this.initExchangeInfo();
                    else this.loop();
                } else {
                    this.updateUI(false);
                    this.dom.prog.classList.add('hidden');
                    this.dom.empty.classList.remove('hidden');
                    clearTimeout(this.timer);
                }
            }

            togglePin(symbol) {
                if (this.pinned.has(symbol) && this.pinned.get(symbol) === Infinity) {
                    this.pinned.delete(symbol);
                } else {
                    this.pinned.set(symbol, Infinity);
                }
                const currentList = Array.from(this.tokens.values()).filter(t => t.lastRendered);
                if(currentList.length > 0) this.render(currentList);
            }

            updateUI(running) {
                this.dom.btn.innerHTML = running ? '<i class="fas fa-stop"></i>' : '<i class="fas fa-play"></i>';
                this.dom.btn.className = running ? "bg-red-600 hover:bg-red-500 text-white font-bold px-6 py-1.5 rounded text-sm flex items-center gap-2" : "bg-highlight hover:bg-yellow-400 text-black font-bold px-6 py-1.5 rounded text-sm flex items-center gap-2";
                this.dom.badge.innerText = running ? "ON" : "OFF";
                this.dom.badge.className = running ? "px-3 py-1 bg-green-900/30 border border-green-700 rounded text-xs text-green-500 font-mono font-bold animate-pulse" : "px-3 py-1 bg-red-900/30 border border-red-700 rounded text-xs text-red-500 font-mono font-bold";
            }

            async initExchangeInfo() {
                try {
                    const res = await fetch(`${API_BASE}/alpha-trade/get-exchange-info?_t=${Date.now()}`);
                    const data = await res.json();
                    if (data.data?.symbols) {
                        data.data.symbols.forEach(s => {
                            if (s.status === 'TRADING' && s.quoteAsset === 'USDT') {
                                if (!this.pairMap.has(s.baseAsset)) this.pairMap.set(s.baseAsset, []);
                                this.pairMap.get(s.baseAsset).push(s.symbol);
                            }
                        });
                        this.loop();
                    }
                } catch (e) { this.toggle(); }
            }

            async loop() {
                if (!this.isRunning) return;
                const start = Date.now();
                try {
                    const res = await fetch(`${API_BASE}/wallet-direct/buw/wallet/cex/alpha/all/token/list?_t=${Date.now()}`);
                    const json = await res.json();
                    this.dom.lat.innerText = (Date.now() - start) + "ms";
                    if (json.data) await this.process(json.data);
                } catch (e) {}
                
                const interval = (parseInt(document.getElementById('cfg-interval').value) || 3) * 1000;
                this.timer = setTimeout(() => this.loop(), interval);
            }

            async process(rawData) {
                const now = Date.now();
                const validTokens = [];
                const blackList = document.getElementById('cfg-black').value.toUpperCase().split(',');
                const scanLimit = parseInt(document.getElementById('cfg-limit').value) || 360;

                rawData.forEach(t => {
                    let pairs = this.pairMap.get(t.alphaId);
                    if (!pairs) pairs = [t.symbol + 'USDT']; 

                    if (!t.price) return; 
                    if (blackList.includes(t.symbol.toUpperCase())) return;

                    let token = this.tokens.get(t.alphaId);
                    const price = parseFloat(t.price);

                    if (!token) {
                        token = {
                            meta: t, pairs: pairs, history: [],
                            volHistory: new Map(),
                            stats: { p: price, c1: 0, c3: 0, c15: 0, v1: 0, v5: 0, n: 0 }, 
                            lastAlert: 0, highlightUntil: 0, skipCounter: 0, lastRendered: false
                        };
                        this.tokens.set(t.alphaId, token);
                    }

                    token.history.push({ t: now, p: price });
                    if (token.history.length > 600) token.history.shift(); 
                    
                    token.stats.p = price;
                    token.stats.c1 = this.calcChg(token.history, now, 60);
                    token.stats.c3 = this.calcChg(token.history, now, 180);
                    token.stats.c15 = this.calcChg(token.history, now, 900);
                    
                    validTokens.push(token);
                });

                const targets = validTokens.sort((a, b) => Math.abs(b.stats.c3) - Math.abs(a.stats.c3)).slice(0, scanLimit);
                
                this.pinned.forEach((expire, symbol) => {
                    if (expire === Infinity || expire > now) {
                        const pinnedToken = validTokens.find(t => t.meta.symbol === symbol);
                        if (pinnedToken && !targets.includes(pinnedToken)) {
                            targets.push(pinnedToken);
                        }
                    } else {
                        this.pinned.delete(symbol);
                    }
                });

                const toFetch = [];
                this.skippedCount = 0;

                targets.forEach(t => {
                    const isPinned = this.pinned.has(t.meta.symbol);
                    
                    if (isPinned || Math.abs(t.stats.c3) > 2.0 || Math.abs(t.stats.c15) > 5.0) {
                        t.skipCounter = 0;
                        toFetch.push(t);
                    } 
                    else if (t.skipCounter > 0) {
                        t.skipCounter--;
                        this.skippedCount++;
                    } else {
                        toFetch.push(t);
                    }
                });

                this.dom.skp.innerText = this.skippedCount;
                
                await this.fetchKlinesBatch(toFetch);
                this.render(targets);
            }

            async fetchKlinesBatch(targets) {
                const BATCH_SIZE = parseInt(document.getElementById('cfg-batch').value) || 30; 
                const SKIP_RESET = parseInt(document.getElementById('cfg-skip').value) || 11;
                let completed = 0;

                for (let i = 0; i < targets.length; i += BATCH_SIZE) {
                    if (!this.isRunning) break;
                    
                    const batch = targets.slice(i, i + BATCH_SIZE);
                    const promises = batch.map(async (token) => {
                        try {
                            const res = await fetch(`${API_BASE}/alpha-trade/klines?symbol=${token.pairs[0]}&interval=15s&limit=20&_t=${Date.now()}`);
                            const d = await res.json();
                            if (d.data) {
                                d.data.forEach(k => {
                                    const t = k[0]; 
                                    const open = parseFloat(k[1]);
                                    const close = parseFloat(k[4]);
                                    const baseVol = parseFloat(k[5]);
                                    const quoteVol = parseFloat(k[7]);
                                    const calcVol = baseVol * close; 
                                    const vol = (quoteVol === 0 || quoteVol < calcVol * 0.5) ? calcVol : quoteVol;
                                    const trades = parseInt(k[8]);
                                    token.volHistory.set(t, { v: vol, n: trades });
                                });
                            }
                        } catch (e) {}

                        const now = Date.now();
                        let v1 = 0, v5 = 0;
                        let n5 = 0; 
                        
                        for (const [t, val] of token.volHistory) {
                            if (now - t > 360000) {
                                token.volHistory.delete(t);
                                continue;
                            }
                            const age = now - t;
                            if (age < 300000) { v5 += val.v; n5 += val.n; }
                            if (age < 60000) v1 += val.v;
                        }
                        
                        token.stats.v5 = v5;
                        token.stats.v1 = v1;
                        token.stats.n = n5;

                        if (v1 === 0 && !this.pinned.has(token.meta.symbol)) token.skipCounter = SKIP_RESET;

                        this.checkAlert(token);
                    });

                    await Promise.all(promises);
                    completed += batch.length;
                    this.dom.bar.style.width = Math.round((completed / targets.length) * 100) + '%';
                }
                setTimeout(() => { this.dom.bar.style.width = '0%'; }, 200);
            }

            // ÁîüÊàêÂîØ‰∏ÄÁöÑÂ∏ÅÁßçËÉåÊôØËâ≤ÂíåËæπÊ°ÜËâ≤ (Âü∫‰∫éÂêçÁß∞HashÔºåÁ°ÆÂÆöÊÄßÁÆóÊ≥ï)
            getSymbolColor(symbol) {
                let hash = 0;
                for (let i = 0; i < symbol.length; i++) {
                    hash = symbol.charCodeAt(i) + ((hash << 5) - hash);
                }
                const h = Math.abs(hash) % 360;
                // ËÉåÊôØËâ≤Ôºö‰Ωé‰∫ÆÂ∫¶(15%)ÔºåÈ´òÈ•±ÂíåÂ∫¶ÔºåÈÄèÊòéÂ∫¶0.9ÔºåÁ°Æ‰øùÊñáÂ≠óÂèØËØª
                // ËæπÊ°ÜËâ≤ÔºöÈ´ò‰∫ÆÂ∫¶(60%)Ôºå‰Ωú‰∏∫ËØÜÂà´Ëâ≤
                return {
                    bg: `hsla(${h}, 70%, 15%, 0.9)`,
                    border: `hsl(${h}, 80%, 60%)`
                };
            }

            checkAlert(token) {
                if (Date.now() - token.lastAlert < 120000) return;

                const s = token.stats;
                const cfgC1 = parseFloat(document.getElementById('cfg-chg1').value) || 2.0;
                const cfgC3 = parseFloat(document.getElementById('cfg-chg3').value) || 6.0;
                const cfgC15 = parseFloat(document.getElementById('cfg-chg15').value) || 8.8;
                const cfgVol = (parseFloat(document.getElementById('cfg-vol').value) || 0) * 1000;
                const cfgTrd = parseFloat(document.getElementById('cfg-trades').value) || 0;
                const repeatCount = parseInt(document.getElementById('cfg-repeat').value) || 3;
                const pinDurationMin = parseFloat(document.getElementById('cfg-pin-dur').value) || 10;
                const onlyUp = document.getElementById('cfg-only-up').checked;

                if (s.v1 < cfgVol || s.n < cfgTrd) return;
                if (onlyUp && s.c1 < 0 && s.c3 < 0 && s.c15 < 0) return;

                let type = null;
                let msg = '';

                if (s.c3 >= cfgC3) {
                    type = 'pump'; msg = `Êö¥Ê∂® ÁôæÂàÜ‰πã${s.c3.toFixed(1)}`;
                } else if (s.c1 >= cfgC1) {
                    type = 'pump'; msg = `‰∏äÊ∂® ÁôæÂàÜ‰πã${s.c1.toFixed(1)}`;
                } else if (s.c15 >= cfgC15) {
                    type = 'pump'; msg = `Ë∂ãÂäø ÁôæÂàÜ‰πã${s.c15.toFixed(1)}`; 
                }

                if (type) {
                    token.lastAlert = Date.now();
                    token.highlightUntil = Date.now() + 30000;
                    
                    const symbol = token.meta.symbol;
                    const addTime = pinDurationMin * 60 * 1000;
                    const now = Date.now();
                    let currentExpire = this.pinned.get(symbol);

                    if (currentExpire !== Infinity) {
                        if (!currentExpire || currentExpire < now) {
                            this.pinned.set(symbol, now + addTime);
                        } else {
                            this.pinned.set(symbol, currentExpire + addTime);
                        }
                    }
                    
                    this.audio.trigger(type, symbol, msg, repeatCount);
                    
                    const color = type === 'pump' ? 'text-highlight' : 'text-up';
                    const badge = type === 'pump' ? 'üöÄ' : '‚ö†Ô∏è';
                    const timeStr = new Date().toLocaleTimeString('en-GB');
                    const priceStr = s.p < 1 ? s.p.toFixed(6) : s.p.toFixed(2);
                    
                    // Ëé∑ÂèñÂ∏ÅÁßç‰∏ìÂ±ûÈ¢úËâ≤ÈÖçÁΩÆ
                    const colors = this.getSymbolColor(symbol);
                    
                    const logHtml = `
                        <div class="mb-2 p-2 rounded border-l-4 transition relative group select-text shadow-lg"
                             style="background: ${colors.bg}; border-left-color: ${colors.border};">
                            <div class="flex justify-between items-start">
                                <div class="flex flex-col cursor-pointer" onclick="window.open('${this.getLink(token)}')">
                                    <div class="flex items-baseline gap-2">
                                        <span class="text-sm font-black tracking-wide text-white hover:brightness-125 transition">${token.meta.symbol}</span>
                                        <span class="text-xs text-gray-300 font-mono">${priceStr}</span>
                                    </div>
                                    <div class="mt-1">
                                         <span class="text-xs ${color} font-bold mix-blend-plus-lighter">${badge} ${msg}</span>
                                    </div>
                                </div>
                                <button onclick="event.stopPropagation(); app.togglePin('${token.meta.symbol}')" 
                                        class="w-8 h-8 flex items-center justify-center rounded bg-black/40 hover:bg-white/20 text-gray-300 hover:text-white transition shadow-sm border border-white/10 ml-2 shrink-0 backdrop-blur-sm" 
                                        title="ÁΩÆÈ°∂ÁõëÊéß">
                                    <i class="fas fa-thumbtack text-xs"></i>
                                </button>
                            </div>
                            <div class="flex justify-end items-center mt-2 border-t border-white/10 pt-1">
                                <span class="text-[11px] text-white font-mono font-bold tracking-wide drop-shadow-md">${timeStr}</span>
                            </div>
                        </div>`;
                    this.dom.logs.insertAdjacentHTML('afterbegin', logHtml);
                }
            }

            render(list) {
                const now = Date.now();
                list.forEach(t => t.lastRendered = true);
                
                list.sort((a, b) => {
                    const symA = a.meta.symbol;
                    const symB = b.meta.symbol;
                    
                    const pinA = this.pinned.get(symA) || 0;
                    const pinB = this.pinned.get(symB) || 0;
                    
                    const isPinA = pinA === Infinity || pinA > now;
                    const isPinB = pinB === Infinity || pinB > now;

                    if (isPinA && !isPinB) return -1;
                    if (!isPinA && isPinB) return 1;

                    if (isPinA && isPinB) return pinB - pinA;

                    return (a.stats[this.sortKey] - b.stats[this.sortKey]) * this.sortDir;
                });

                const cfgVol = (parseFloat(document.getElementById('cfg-vol').value) || 0) * 1000;
                const cfgTrd = parseFloat(document.getElementById('cfg-trades').value) || 0;
                const cfgPinDur = (parseFloat(document.getElementById('cfg-pin-dur').value) || 10) * 60 * 1000;

                let html = '';
                list.forEach((t, idx) => {
                    const s = t.stats;
                    const isLocked = t.highlightUntil && now < t.highlightUntil;
                    const pinExpire = this.pinned.get(t.meta.symbol);
                    const isPinned = pinExpire === Infinity || (pinExpire && pinExpire > now);
                    const isQualified = s.v1 >= cfgVol && s.n >= cfgTrd;
                    
                    let rowClass = 'border-b border-[#1e2329] transition-all duration-200';
                    if (isPinned) rowClass += ' pinned-row'; 
                    else if (isLocked) rowClass += ' highlight-lock'; 
                    else if (t.skipCounter > 0) rowClass += ' opacity-20 grayscale'; 
                    else if (!isQualified) rowClass += ' dimmed hover:opacity-100';
                    else rowClass += ' hover:bg-[#1e2329]';

                    const c1Color = s.c1 > 0 ? 'text-up' : (s.c1 < 0 ? 'text-down' : 'text-gray-500');
                    const c3Color = s.c3 > 0 ? 'text-up' : (s.c3 < 0 ? 'text-down' : 'text-gray-500');
                    const c15Color = s.c15 > 0 ? 'text-up' : (s.c15 < 0 ? 'text-down' : 'text-gray-500');
                    const v1Color = s.v1 > 5000 ? 'text-highlight font-bold' : 'text-gray-300'; 
                    
                    let pinIconClass = isPinned ? 'fas fa-thumbtack pinned-icon' : 'fas fa-thumbtack unpinned-icon text-opacity-20';
                    let pinTitle = isPinned ? (pinExpire === Infinity ? 'ÊâãÂä®ÁΩÆÈ°∂' : `Ââ©‰Ωô ${(pinExpire - now)/60000 | 0} ÂàÜÈíü`) : 'ÁÇπÂáªÁΩÆÈ°∂';

                    let heatHtml = '';
                    if (isPinned) {
                        if (pinExpire === Infinity) {
                            heatHtml = `
                                <div class="flex items-center justify-end gap-2">
                                    <span class="text-xs font-bold text-accent tracking-wider">LOCK</span>
                                    <div class="heat-bg"><div class="heat-fill bg-accent" style="width:100%"></div></div>
                                </div>`;
                        } else {
                            const left = Math.max(0, pinExpire - now);
                            const percent = Math.min(100, (left / cfgPinDur) * 100);
                            const minDisplay = (left / 60000).toFixed(1) + 'm';
                            heatHtml = `
                                <div class="flex items-center justify-end gap-2">
                                    <span class="text-xs text-blue-400 font-mono">${minDisplay}</span>
                                    <div class="heat-bg"><div class="heat-fill bg-blue-500" style="width:${percent}%"></div></div>
                                </div>`;
                        }
                    } else {
                        heatHtml = `<span class="text-subtext text-[10px] opacity-20">-</span>`;
                    }

                    html += `
                    <tr class="${rowClass}">
                        <td class="text-center" onclick="app.togglePin('${t.meta.symbol}')" title="${pinTitle}">
                            <i class="${pinIconClass}"></i>
                        </td>
                        <td class="text-left font-bold">
                            <span class="text-[9px] text-gray-600 w-4 inline-block text-right mr-1">${idx+1}</span>
                            <a href="${this.getLink(t)}" target="_blank" class="text-white coin-link">${t.meta.symbol}</a>
                            <span class="text-[9px] text-gray-500 font-sans ml-1">${t.meta.chainName}</span>
                        </td>
                        <td class="font-mono text-white tracking-tight">${s.p < 1 ? s.p.toFixed(6) : s.p.toFixed(2)}</td>
                        <td class="font-mono font-bold ${c1Color}">${s.c1 > 0 ? '+' : ''}${s.c1.toFixed(2)}%</td>
                        <td class="font-mono font-bold ${c3Color}">${s.c3 > 0 ? '+' : ''}${s.c3.toFixed(2)}%</td>
                        <td class="font-mono font-bold ${c15Color}">${s.c15 > 0 ? '+' : ''}${s.c15.toFixed(2)}%</td>
                        <td class="font-mono">
                            ${heatHtml}
                        </td>
                        <td class="font-mono ${v1Color}">${(s.v1/1000).toFixed(1)}K</td>
                        <td class="font-mono text-gray-500">${(s.v5/1000).toFixed(1)}K</td>
                        <td class="font-mono text-subtext">${s.n}</td>
                    </tr>`;
                });
                this.dom.body.innerHTML = html;
            }

            getLink(token) {
                const chainSlug = token.meta.chainName ? token.meta.chainName.toLowerCase().replace(/\s+/g, '-') : 'unknown';
                return `https://www.binance.com/zh-CN/alpha/${chainSlug}/${token.meta.contractAddress}`;
            }

            calcChg(h, now, s) {
                const ref = h.find(x => x.t >= now - s * 1000);
                return ref ? ((h[h.length - 1].p - ref.p) / ref.p) * 100 : 0;
            }
            sort(key) {
                if (this.sortKey === key) this.sortDir *= -1; else { this.sortKey = key; this.sortDir = -1; }
                document.querySelectorAll('th').forEach(th => th.classList.remove('active-sort'));
                document.getElementById('th-'+key)?.classList.add('active-sort');
            }
        }

        const app = new Terminal();
        document.getElementById('btn-toggle').onclick = () => app.toggle();
        document.getElementById('clear-logs').onclick = () => document.getElementById('console-logs').innerHTML = '';
    </script>
</body>
</html>
